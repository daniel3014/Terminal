<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Terminal</title>

<style>
:root{
  --glass-light: rgba(255,255,255,0.55);
  --glass-dark: rgba(20,28,45,0.55);
  --border-light: rgba(255,255,255,0.35);
  --border-dark: rgba(255,255,255,0.15);

  --blur: blur(22px);
  --shadow: 0 25px 50px rgba(0,0,0,0.25);

  --grid-size: 60px;
  --grid-gap: 18px;
  --shadow-inset: 12px;

  --cols: 12;
}

body[data-theme="light"]{
  background: linear-gradient(135deg, #e6f1ff, #cfe4ff);
  color: #0f172a;
  --grid-line: rgba(0,0,0,0.08);
}
body[data-theme="dark"]{
  background: linear-gradient(135deg, #020617, #0b1220);
  color: #e5e7eb;
  --grid-line: rgba(255,255,255,0.14);
}

*{ box-sizing:border-box; font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",sans-serif; }
body{ margin:0; min-height:100vh; padding:24px 16px; }

body.edit-mode::before{
  content:"";
  position:fixed;
  inset:0;
  background-image:
    linear-gradient(to right, var(--grid-line) 1px, transparent 1px),
    linear-gradient(to bottom, var(--grid-line) 1px, transparent 1px);
  background-size: calc(var(--grid-size) + var(--grid-gap)) calc(var(--grid-size) + var(--grid-gap));
  pointer-events:none;
  z-index:0;
}

.app{
  max-width:1200px;
  margin:auto;
  position:relative;
  z-index:1;

  display:grid;
  grid-template-columns: repeat(var(--cols), minmax(0, var(--grid-size)));
  grid-auto-rows: var(--grid-size);
  gap: var(--grid-gap);
  align-content:start;
}

.widget-wrap{
  position:relative;

  --col: 1;
  --row: 1;
  --w: 4;
  --h: 2;

  grid-column: var(--col) / span var(--w);
  grid-row: var(--row) / span var(--h);

  touch-action:none;
  user-select:none;
}

.widget-shadow{
  position:absolute;
  inset: var(--shadow-inset);
  border-radius: calc(26px - var(--shadow-inset));
  box-shadow: var(--shadow);
  pointer-events:none;
  z-index: 1;
}

.widget-wrap > .widget{
  height:100%;
  width:100%;
  background: var(--glass-light);
  backdrop-filter: var(--blur);
  border: 1px solid var(--border-light);
  border-radius: 26px;
  padding: 22px;
  position:relative;
  z-index:2;
}

body[data-theme="dark"] .widget-wrap > .widget{
  background: var(--glass-dark);
  border-color: var(--border-dark);
}

.edit-mode .widget-wrap > .widget{ cursor:grab; }

.widget-wrap.dragging{
  z-index:50;
  position:fixed !important;
  pointer-events:none;
}

.widget.clock{ text-align:center; }
.clock-time{ font-size:64px; }
.clock-date{ opacity:0.6; }
.widget.forecast{ display:flex; justify-content:space-between; }
</style>
</head>

<body data-theme="light">

<div class="app" id="grid">

  <div class="widget" data-widget-id="w-weather" data-w="4" data-h="2">
    <strong>23Â°C â˜€ï¸</strong><br>
    SensaÃ§Ã£o 25Â° Â· Chuva 10%
  </div>

  <div class="widget clock" data-widget-id="w-clock" data-w="8" data-h="3">
    <div class="clock-time" id="time"></div>
    <div class="clock-date" id="date"></div>
  </div>

  <div class="widget forecast" data-widget-id="w-forecast" data-w="4" data-h="2">
    <span>â˜€ï¸ 24Â°</span>
    <span>ğŸŒ§ï¸ 22Â°</span>
    <span>â›… 23Â°</span>
  </div>

</div>

<script>
/* CLOCK */
function updateClock(){
  const now = new Date();
  time.textContent = now.toLocaleTimeString("pt-BR",{hour:"2-digit",minute:"2-digit"});
  date.textContent = now.toLocaleDateString("pt-BR",{weekday:"long",day:"numeric",month:"long"});
}
updateClock();
setInterval(updateClock,1000);

/* GRID */
const gridEl = document.getElementById("grid");
const GRID = 60;
const GAP = 18;

function pitch(){ return GRID + GAP; }

function computeCols(){
  const w = gridEl.clientWidth;
  const cols = Math.max(1, Math.floor((w + GAP) / pitch()));
  document.documentElement.style.setProperty("--cols", cols);
  return cols;
}

function wrapWidgets(){
  document.querySelectorAll("#grid > .widget").forEach(w=>{
    if(w.parentElement.classList.contains("widget-wrap")) return;

    const wrap = document.createElement("div");
    wrap.className="widget-wrap";
    wrap.style.setProperty("--w", w.dataset.w || 4);
    wrap.style.setProperty("--h", w.dataset.h || 2);

    const shadow=document.createElement("div");
    shadow.className="widget-shadow";

    w.parentNode.insertBefore(wrap,w);
    wrap.appendChild(shadow);
    wrap.appendChild(w);
  });
}

wrapWidgets();
computeCols();

/* DRAG */
let dragged=null, offsetX=0, offsetY=0;

function pointToCell(cx, cy, w){
  const r = gridEl.getBoundingClientRect();
  const x = cx - r.left;
  const col = Math.floor(x / pitch()) + 1;
  return Math.max(1, Math.min(col, computeCols() - w + 1));
}

document.querySelectorAll(".widget-wrap").forEach(w=>{
  w.addEventListener("pointerdown", e=>{
    dragged=w;
    const r=w.getBoundingClientRect();
    offsetX=e.clientX-r.left;
    offsetY=e.clientY-r.top;
    w.classList.add("dragging");
    w.style.left=r.left+"px";
    w.style.top=r.top+"px";
    w.style.width=r.width+"px";
    w.style.height=r.height+"px";
    w.setPointerCapture(e.pointerId);
  });

  w.addEventListener("pointermove", e=>{
    if(!dragged) return;
    dragged.style.left=(e.clientX-offsetX)+"px";
    dragged.style.top=(e.clientY-offsetY)+"px";

    const wCells=parseInt(getComputedStyle(dragged).getPropertyValue("--w"));
    const col=pointToCell(e.clientX, e.clientY, wCells);
    dragged.style.setProperty("--col", col);
  });

  w.addEventListener("pointerup", e=>{
    if(!dragged) return;
    dragged.classList.remove("dragging");
    dragged.style.left="";
    dragged.style.top="";
    dragged.style.width="";
    dragged.style.height="";
    dragged.releasePointerCapture(e.pointerId);
    dragged=null;
  });
});
</script>

</body>
</html>
