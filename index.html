<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Terminal</title>

<style>
:root{
  --glass-light: rgba(255,255,255,0.55);
  --glass-dark: rgba(20,28,45,0.55);
  --border-light: rgba(255,255,255,0.35);
  --border-dark: rgba(255,255,255,0.15);

  --blur: blur(22px);
  --shadow: 0 25px 50px rgba(0,0,0,0.25);

  --grid-size: 60px;
  --grid-gap: 18px;
  --shadow-inset: 12px;

  --cols: 12;
  --cell-w: 60px;
}

body[data-theme="light"]{
  background: linear-gradient(135deg,#e6f1ff,#cfe4ff);
  color:#0f172a;
}
body[data-theme="dark"]{
  background: linear-gradient(135deg,#020617,#0b1220);
  color:#e5e7eb;
}

*{box-sizing:border-box;font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",sans-serif;}
body{margin:0;min-height:100vh;padding:24px 16px;}

.app{
  width:100%;
  display:grid;
  grid-template-columns:repeat(var(--cols),1fr);
  grid-auto-rows:var(--grid-size);
  gap:var(--grid-gap);
}

.widget-wrap{
  position:relative;
  --col:1;
  --row:1;
  --w:4;
  --h:2;
  --base-w:4;
  --base-h:2;

  grid-column:var(--col)/span var(--w);
  grid-row:var(--row)/span var(--h);
}

.widget-shadow{
  position:absolute;
  inset:12px;
  border-radius:20px;
  box-shadow:var(--shadow);
}

.widget{
  width:100%;
  height:100%;
  background:var(--glass-light);
  backdrop-filter:var(--blur);
  border:1px solid var(--border-light);
  border-radius:26px;
  padding:22px;
  position:relative;
  z-index:2;
}

body[data-theme="dark"] .widget{
  background:var(--glass-dark);
  border-color:var(--border-dark);
}
</style>
</head>

<body data-theme="light">

<div class="app" id="grid">

<div class="widget" data-w="4" data-h="2">Clima</div>
<div class="widget" data-w="8" data-h="3">Relógio</div>
<div class="widget" data-w="4" data-h="2">Previsão</div>

</div>

<script>

/* GRID */

const gridEl=document.getElementById("grid");
const GRID=60;
const GAP=18;

function computeCols(){
  const width=gridEl.clientWidth;
  const cols=Math.max(1,Math.floor((width+GAP)/(GRID+GAP)));
  document.documentElement.style.setProperty("--cols",cols);

  const cellW=(width-(cols-1)*GAP)/cols;
  document.documentElement.style.setProperty("--cell-w",cellW+"px");

  return {cols,cellW};
}

/* WRAP */

function ensureWrappedWidgets(){

  document.querySelectorAll("#grid>.widget").forEach(w=>{

    if(w.parentElement.classList.contains("widget-wrap")) return;

    const wrap=document.createElement("div");
    wrap.className="widget-wrap";

    const dw=parseInt(w.dataset.w)||4;
    const dh=parseInt(w.dataset.h)||2;

    wrap.style.setProperty("--base-w",dw);
    wrap.style.setProperty("--base-h",dh);
    wrap.style.setProperty("--w",dw);
    wrap.style.setProperty("--h",dh);

    const shadow=document.createElement("div");
    shadow.className="widget-shadow";

    w.parentNode.insertBefore(wrap,w);
    wrap.appendChild(shadow);
    wrap.appendChild(w);

  });

}

/* HELPERS */

function allWidgetWraps(){
  return [...document.querySelectorAll(".widget-wrap")];
}

function getGridPos(el){
  const cs=getComputedStyle(el);
  return{
    col:parseInt(cs.getPropertyValue("--col"))||1,
    row:parseInt(cs.getPropertyValue("--row"))||1,
    w:parseInt(cs.getPropertyValue("--w"))||4,
    h:parseInt(cs.getPropertyValue("--h"))||2
  };
}

function setGridSize(el,w,h){
  el.style.setProperty("--w",w);
  el.style.setProperty("--h",h);
}

/* RESPONSIVE OS ENGINE */

function getDensity(cols,width){
  if(width<480) return "ultra";
  if(cols<=4) return "compact";
  if(cols<=9) return "normal";
  return "expanded";
}

function densityScale(density){
  switch(density){
    case"ultra":return .45;
    case"compact":return .65;
    case"normal":return 1;
    case"expanded":return 1.15;
  }
  return 1;
}

function applyResponsiveLayout(){

  const {cols}=computeCols();
  const density=getDensity(cols,window.innerWidth);
  const scale=densityScale(density);

  for(const el of allWidgetWraps()){

    const cs=getComputedStyle(el);
    const baseW=parseInt(cs.getPropertyValue("--base-w"))||4;
    const baseH=parseInt(cs.getPropertyValue("--base-h"))||2;

    const newW=Math.max(1,Math.round(baseW*scale));
    const newH=Math.max(1,Math.round(baseH*scale));

    setGridSize(el,newW,newH);
  }

}

/* ANIMATION */

function animateReflow(){

  const rects=new Map();

  for(const el of allWidgetWraps()){
    rects.set(el,el.getBoundingClientRect());
  }

  requestAnimationFrame(()=>{

    for(const el of allWidgetWraps()){

      const oldRect=rects.get(el);
      const newRect=el.getBoundingClientRect();

      const dx=oldRect.left-newRect.left;
      const dy=oldRect.top-newRect.top;

      if(dx||dy){

        el.style.transition="none";
        el.style.transform=`translate(${dx}px,${dy}px)`;

        requestAnimationFrame(()=>{
          el.style.transition="transform 260ms cubic-bezier(.2,.9,.2,1)";
          el.style.transform="";
        });

      }

    }

  });

}

/* INIT */

ensureWrappedWidgets();

let lastCols=computeCols().cols;

const ro=new ResizeObserver(()=>{

  const newCols=computeCols().cols;

  applyResponsiveLayout();
  animateReflow();

  lastCols=newCols;

});

ro.observe(gridEl);

applyResponsiveLayout();

</script>
</body>
</html>
