<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Terminal</title>

<style>
/* ===== VARS ===== */
:root{
  --glass-light: rgba(255,255,255,0.55);
  --glass-dark: rgba(20,28,45,0.55);
  --border-light: rgba(255,255,255,0.35);
  --border-dark: rgba(255,255,255,0.15);

  --blur: blur(22px);
  --shadow: 0 25px 50px rgba(0,0,0,0.25);

  --grid-size: 60px;
  --grid-gap: 18px;
  --shadow-inset: 12px;

  --cols: 12;
}

/* ===== THEMES ===== */
body[data-theme="light"]{
  background: linear-gradient(135deg, #e6f1ff, #cfe4ff);
  color: #0f172a;
  --grid-line: rgba(0,0,0,0.08);
  --preview-border: rgba(15,23,42,.22);
  --preview-fill: rgba(255,255,255,.22);
}
body[data-theme="dark"]{
  background: linear-gradient(135deg, #020617, #0b1220);
  color: #e5e7eb;
  --grid-line: rgba(255,255,255,.14);
  --preview-border: rgba(255,255,255,.22);
  --preview-fill: rgba(255,255,255,.08);
}

*{ box-sizing:border-box; font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",sans-serif; }
body{ margin:0; min-height:100vh; padding:24px 16px; }

/* ===== GRID OVERLAY ===== */
body.edit-mode::before{
  content:"";
  position:fixed;
  inset:0;
  background-image:
    linear-gradient(to right, var(--grid-line) 1px, transparent 1px),
    linear-gradient(to bottom, var(--grid-line) 1px, transparent 1px);
  background-size: calc(var(--grid-size) + var(--grid-gap)) calc(var(--grid-size) + var(--grid-gap));
  pointer-events:none;
  z-index:0;
}

/* ===== GRID ===== */
.app{
  max-width:1200px;
  margin:auto;
  display:grid;
  grid-template-columns: repeat(var(--cols), minmax(0, var(--grid-size)));
  grid-auto-rows: var(--grid-size);
  gap: var(--grid-gap);
  align-content:start;
  position:relative;
  z-index:1;
}

/* ===== WIDGET ===== */
.widget-wrap{
  position:relative;
  --col:1;
  --row:1;
  --w:4;
  --h:2;
  grid-column: var(--col) / span var(--w);
  grid-row: var(--row) / span var(--h);
  touch-action:none;
  user-select:none;
}

.widget-shadow{
  position:absolute;
  inset: var(--shadow-inset);
  border-radius: calc(26px - var(--shadow-inset));
  box-shadow: var(--shadow);
  pointer-events:none;
}

.widget-wrap > .widget{
  width:100%;
  height:100%;
  background: var(--glass-light);
  backdrop-filter: var(--blur);
  border:1px solid var(--border-light);
  border-radius:26px;
  padding:22px;
  position:relative;
}

body[data-theme="dark"] .widget-wrap > .widget{
  background: var(--glass-dark);
  border-color: var(--border-dark);
}

/* ===== PREVIEW ===== */
.widget-wrap.drop-preview .widget{
  background: var(--preview-fill);
  border:1.5px dashed var(--preview-border);
  backdrop-filter:none;
}
.widget-wrap.drop-preview .widget-shadow{
  box-shadow:none;
}

/* ===== DRAG ===== */
.widget-wrap.dragging{
  position:fixed !important;
  pointer-events:none;
  z-index:50;
}

/* ===== CLOCK ===== */
.widget.clock{ text-align:center; }
.clock-time{ font-size:64px; }
.clock-date{ opacity:.6; }

/* ===== FORECAST ===== */
.widget.forecast{ display:flex; justify-content:space-between; }

/* ===== EDIT TOGGLE ===== */
.edit-toggle{
  position:fixed;
  right:20px;
  bottom:20px;
  height:44px;
  padding:0 14px;
  border-radius:999px;
  background: var(--glass-light);
  backdrop-filter: var(--blur);
  border:1px solid var(--border-light);
  display:flex;
  align-items:center;
  gap:10px;
  cursor:pointer;
  z-index:90;
}
body[data-theme="dark"] .edit-toggle{
  background: var(--glass-dark);
  border-color: var(--border-dark);
}
.edit-toggle .dot{
  width:10px;
  height:10px;
  border-radius:999px;
  background:rgba(0,0,0,.3);
}
body.edit-mode .edit-toggle .dot{
  background:#22c55e;
}
</style>
</head>

<body>

<div class="edit-toggle" id="editToggle">
  <div class="dot"></div>
  <div id="editToggleText">Editar</div>
</div>

<div class="app" id="grid">
  <div class="widget" data-widget-id="w-weather" data-w="4" data-h="2">
    <strong>23Â°C â˜€ï¸</strong><br>SensaÃ§Ã£o 25Â°
  </div>

  <div class="widget clock" data-widget-id="w-clock" data-w="8" data-h="3">
    <div class="clock-time" id="time"></div>
    <div class="clock-date" id="date"></div>
  </div>

  <div class="widget forecast" data-widget-id="w-forecast" data-w="4" data-h="2">
    <span>â˜€ï¸ 24Â°</span><span>ğŸŒ§ï¸ 22Â°</span><span>â›… 23Â°</span>
  </div>
</div>

<script>
/* ===== CLOCK ===== */
function updateClock(){
  const n=new Date();
  time.textContent=n.toLocaleTimeString("pt-BR",{hour:"2-digit",minute:"2-digit"});
  date.textContent=n.toLocaleDateString("pt-BR",{weekday:"long",day:"numeric",month:"long"});
}
updateClock(); setInterval(updateClock,1000);

/* ===== GRID HELPERS ===== */
const grid=document.getElementById("grid");
const GRID=60, GAP=18;
const HYSTERESIS=0.65;

function pitch(){ return GRID+GAP; }

function computeCols(){
  const cols=Math.max(1,Math.floor((grid.clientWidth+GAP)/pitch()));
  document.documentElement.style.setProperty("--cols",cols);
  return cols;
}

function wrapWidgets(){
  document.querySelectorAll("#grid>.widget").forEach(w=>{
    if(w.parentElement.classList.contains("widget-wrap")) return;
    const wrap=document.createElement("div");
    wrap.className="widget-wrap";
    wrap.style.setProperty("--w",w.dataset.w||4);
    wrap.style.setProperty("--h",w.dataset.h||2);
    const shadow=document.createElement("div");
    shadow.className="widget-shadow";
    w.parentNode.insertBefore(wrap,w);
    wrap.appendChild(shadow);
    wrap.appendChild(w);
  });
}
wrapWidgets(); computeCols();

/* ===== EDIT MODE ===== */
const editToggle=document.getElementById("editToggle");
const editText=document.getElementById("editToggleText");
editToggle.onclick=()=>{
  document.body.classList.toggle("edit-mode");
  editText.textContent=document.body.classList.contains("edit-mode")?"Concluir":"Editar";
};

/* ===== DRAG ===== */
let dragged=null, preview=null, offX=0, offY=0;

function cellFromCenter(cx){
  const r=grid.getBoundingClientRect();
  const raw=(cx-r.left)/pitch();
  const base=Math.floor(raw);
  const frac=raw-base;
  let col=(frac>HYSTERESIS?base+1:base)+1;
  const maxCol=computeCols()-parseInt(getComputedStyle(dragged).getPropertyValue("--w"))+1;
  return Math.max(1,Math.min(col,maxCol));
}

function makePreview(src){
  const p=document.createElement("div");
  p.className="widget-wrap drop-preview";
  ["--w","--h","--col","--row"].forEach(v=>p.style.setProperty(v,getComputedStyle(src).getPropertyValue(v)));
  p.innerHTML=`<div class="widget-shadow"></div><div class="widget"></div>`;
  return p;
}

document.querySelectorAll(".widget-wrap").forEach(w=>{
  w.onpointerdown=e=>{
    if(!document.body.classList.contains("edit-mode")) return;
    dragged=w;
    const r=w.getBoundingClientRect();
    offX=e.clientX-r.left;
    offY=e.clientY-r.top;
    preview=makePreview(w);
    w.after(preview);
    w.classList.add("dragging");
    Object.assign(w.style,{
      left:r.left+"px", top:r.top+"px",
      width:r.width+"px", height:r.height+"px"
    });
    w.setPointerCapture(e.pointerId);
  };

  w.onpointermove=e=>{
    if(!dragged) return;
    dragged.style.left=(e.clientX-offX)+"px";
    dragged.style.top=(e.clientY-offY)+"px";
    const centerX=e.clientX-offX+dragged.offsetWidth/2;
    preview.style.setProperty("--col",cellFromCenter(centerX));
  };

  w.onpointerup=e=>{
    if(!dragged) return;
    dragged.style.cssText="";
    dragged.style.setProperty("--col",preview.style.getPropertyValue("--col"));
    dragged.classList.remove("dragging");
    preview.remove(); preview=null;
    dragged.releasePointerCapture(e.pointerId);
    dragged=null;
  };
});

/* ===== THEME (AUTO DEFAULT) ===== */
function applyTheme(mode){
  if(mode==="auto"){
    const h=new Date().getHours();
    document.body.dataset.theme=(h>=6&&h<18)?"light":"dark";
  }else{
    document.body.dataset.theme=mode;
  }
}
applyTheme("auto");
</script>

</body>
</html>
